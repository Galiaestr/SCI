<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>ICATLAX - Cursos Disponibles</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <header class="container-fluid header-area py-3">
        <div class="row justify-content-center align-items-center">
            <div class="col-12 text-center">
                <div class="logo-and-text">
                    <img src="{{ url_for('static', filename='images/Icatlax-logo.png') }}" alt="ICATLAX"
                        class="img-fluid icatlax-symbol-logo">
                </div>
            </div>
        </div>
    </header>

    {% include 'partials/navbar.html' %}


    <main class="flex-grow-1">
        <div class="container py-5">
            <h2 class="category-title mb-0 text-center"> Cursos Disponibles</h2> <br>

            <form method="GET" action="{{ url_for('cursos_publico.resultados') }}" class="mb-4 position-relative">
                <div class="input-group">
                    <input type="text" name="q" class="form-control" placeholder="Buscar curso o categor√≠a..."
                        autocomplete="off" required>
                    <button type="submit" class="btn btn-sm" style="background-color: #d3d3d3; color: black;">
                        Buscar
                    </button>

                </div>

                <div id="sugerencias" class="mt-1"></div>

            </form>
            <script>
                document.addEventListener('DOMContentLoaded', function () {
                    const input = document.querySelector('input[name="q"]');
                    const sugerenciasDiv = document.getElementById('sugerencias');

                    input.addEventListener('input', function () {
                        const query = this.value.trim();
                        if (query.length >= 2) {
                            fetch(`/autocompletar?q=${encodeURIComponent(query)}`)
                                .then(response => response.json())
                                .then(data => {
                                    sugerenciasDiv.innerHTML = '';
                                    data.forEach(item => {
                                        const div = document.createElement('div');
                                        div.className = 'alert alert-secondary py-1 px-3 mb-1 shadow-sm';
                                        div.style.cursor = 'pointer';
                                        div.textContent = item;
                                        div.onclick = function () {
                                            input.value = item;
                                            sugerenciasDiv.innerHTML = '';
                                        };
                                        sugerenciasDiv.appendChild(div);
                                    });
                                });
                        } else {
                            sugerenciasDiv.innerHTML = '';
                        }
                    });
                });
            </script>

            {% if cursos %}
            <div class="row">
                {% for curso in cursos %}
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 shadow-sm"
                        data-url="{{ url_for('cursos_publico.verCursoPublico', id=curso.id_curso) }}"
                        onclick="window.location = this.dataset.url" style="cursor: pointer;">

                        {% if curso.id_curso in curso_imagenes and curso_imagenes[curso.id_curso]|length > 0 %}
                        <img src="{{ url_for('static', filename='img/' ~ curso_imagenes[curso.id_curso][0]) }}"
                            class="card-img-top img-fluid" style="height: 180px; object-fit: cover;"
                            alt="Imagen del curso {{ curso.nombre_curso }}">
                        {% else %}
                        <div class="card-img-top bg-light text-center p-4 text-muted" style="height: 180px;">
                            <i class="fas fa-image fa-2x mb-2"></i><br>
                            Sin imagen disponible
                        </div>
                        {% endif %}

                        <div class="card-body">
                            <h5 class="card-title texto-morado fw-bold">{{ curso.nombre_curso }}</h5>
                            <span class="badge badge-primary">{{ curso.nombre_categoria }}</span>

                            <p class="card-text text-muted">
                                {% if curso.descripcion %}
                                {{ curso.descripcion[:100] }}{% if curso.descripcion|length > 100 %}...{% endif %}
                                {% else %}
                                <span class="text-muted">Sin descripci√≥n disponible</span>
                                {% endif %}
                            </p>
                        </div>

                        <div class="card-footer bg-white border-top text-center">
                            <a href="{{ url_for('cursos_publico.registroCurso', id=curso.id_curso) }}"
                                class="btn btn-success btn-block mt-3"
                                aria-label="Registrarse al curso {{ curso.nombre_curso }}">
                                üìù Registrarse
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}

            </div>
            {% else %}
            <p class="text-muted text-center mt-5">üö´ Actualmente no hay cursos disponibles.</p>
            {% endif %}

            <div class="text-center mt-4">
                <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                    ‚Üê Volver al inicio
                </a>
            </div>
        </div>
    </main>

    <footer class="container-fluid footer-area py-4 text-center">
        <p class="mb-1">M√≥dulo de Capacitaci√≥n ICATLAX-Xiloxochitla</p>
        <p class="mb-1">Direcci√≥n: Plaza de comunidad s/n, San Vicente Xiloxochitla, Nativitas, Tlax.</p>
        <p class="mb-1">Tel√©fonos: 248 160 8547 y 246 416 1562</p>
        <p class="mb-1">Email: presidencia@xiloxochitla.mx</p>
        <p class="mb-0">¬© 2024-2025 Xiloxochitla</p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>